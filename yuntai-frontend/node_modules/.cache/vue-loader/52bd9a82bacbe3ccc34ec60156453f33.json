{"remainingRequest":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/chenchi03/IdeaProjects/yuntai-frontend/src/views/acl/role/list.vue?vue&type=style&index=0&id=0a57fab0&scoped=true&lang=css","dependencies":[{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/src/views/acl/role/list.vue","mtime":1672390200000},{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/css-loader/dist/cjs.js","mtime":1749371729491},{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1749371729849},{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/postcss-loader/src/index.js","mtime":1749371729594},{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1749371729293},{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/vue-loader/lib/index.js","mtime":1749371729670}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouZWRpdC1pbnB1dCB7CiAgcGFkZGluZy1yaWdodDogMTAwcHg7Cn0KCi5jYW5jZWwtYnRuIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgcmlnaHQ6IDE1cHg7CiAgdG9wOiAxMHB4Owp9CgoudGFibGVDc3MgewogIHdpZHRoOiAxMDAlOwogIG1hcmdpbi10b3A6IDEwcHg7CiAgYm9yZGVyOiAxcHggc29saWQgI2ViZWVmNTsKfQoKdGFibGU+dHI+dGggewogIHBhZGRpbmc6IDEwcHg7Cn0KCnRhYmxlPnRyPnRkIHsKICBwYWRkaW5nOiAxMHB4Owp9CgpidXR0b24gewogIG1hcmdpbjogMTBweDsKfQo="},{"version":3,"sources":["list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+IA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/acl/role","sourcesContent":["<template>\n  <div>\n    <!-- 工具条 -->\n    <el-card class=\"operate-container\" shadow=\"never\">\n      <i class=\"el-icon-tickets\" style=\"margin-top: 5px\"></i>\n      <span style=\"margin-top: 5px\">数据列表</span>\n      <el-button class=\"btn-add\" size=\"mini\" @click=\"addRole\">添加新角色</el-button>\n    </el-card>\n\n    <table class=\"tableCss\">\n      <tr style=\"text-align: center;\">\n        <th>ID</th>\n        <th>角色名称</th>\n        <th>操作</th>\n      </tr>\n      <tr v-for=\"item in roles\" style=\"text-align: center;\">\n        <td>{{ item.id }}</td>\n        <td>{{ item.roleName }}</td>\n        <td>\n          <button @click=\"removeRole(item.id, item.roleName)\">删除角色</button>\n          <button @click=\"showAssignRoleDialog(item.id, item.roleName)\">分配权限</button>\n        </td>\n      </tr>\n    </table>\n\n    <el-dialog title=\"添加/修改\" :visible.sync=\"dialogVisible\" width=\"40%\">\n      <el-input disabled :value=\"roleName\" />\n      <el-tree ref=\"tree\" style=\"margin: 20px 0\" :data=\"allPermissions\" node-key=\"id\" show-checkbox default-expand-all\n        :props=\"defaultProps\" />\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button size=\"small\" @click=\"dialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" size=\"small\" @click=\"assignRoles()\">确定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'RoleList',\n  data() {\n    return {\n      dialogVisible: false,\n      allPermissions: [],\n      roleId: -1,\n      roleName: '',\n      defaultProps: {\n        children: 'children',\n        label: 'permissionName'\n      },\n      listLoading: true, // 数据是否正在加载\n      roles: [], // 角色列表\n      selectedRoles: [] // 所有选中的角色列表\n    }\n  },\n  mounted() {\n    this.getRoles()\n  },\n  methods: {\n    /*\n    添加角色\n    */\n    addRole() {\n      // 显示添加界面\n      this.$prompt('请输入新名称', '添加角色', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n      }).then(({ value }) => {\n        this.$API.role.save({ roleName: value }).then(result => {\n          this.$message.success(result.message || '添加角色成功')\n          this.getRoles()\n        })\n      }).catch(() => {\n        this.$message.warning('取消添加')\n      })\n    },\n    showAssignRoleDialog(roleId, roleName) {\n      this.roleId = roleId;\n      this.roleName = roleName;\n      this.dialogVisible = true;\n      this.$API.permission.toAssign(roleId).then(result => {\n        const allPermissions = result.data\n        this.allPermissions = allPermissions\n        const checkedIds = this.getCheckedIds(allPermissions)\n        console.log('getPermissions() checkedIds', checkedIds)\n        this.$refs.tree.setCheckedKeys(checkedIds)\n      });\n    },\n\n    /*\n      得到所有选中的id列表\n      */\n    getCheckedIds(auths, initArr = []) {\n      return auths.reduce((pre, item) => {\n        console.log(item.select);\n        if (item.select && item.level === 3) {\n          pre.push(item.id)\n        } else if (item.children) {\n          this.getCheckedIds(item.children, initArr)\n        }\n        return pre\n      }, initArr)\n    },\n\n    /*\n    异步获取角色分页列表\n    */\n    getRoles(page = 1) {\n      this.page = page\n      this.listLoading = true\n      this.$API.role.getPageList().then(\n        result => {\n          this.roles = result.data;\n        }\n      ).finally(() => {\n        this.listLoading = false;\n      })\n    },\n    /*\n    删除指定的角色\n    */\n    removeRole(roleId, roleName) {\n      this.$confirm(`确定删除 '${roleName}' 吗?`, '提示', {\n        type: 'warning'\n      }).then(async () => {\n        const result = await this.$API.role.removeById(roleId);\n        this.getRoles(this.roles.length === 1 ? this.page - 1 : this.page);\n        this.$message.success(result.message || '删除成功!');\n      }).catch(() => {\n        this.$message.info('已取消删除');\n      })\n    },\n    assignRoles() {\n      var ids = this.$refs.tree.getCheckedKeys().join(',');\n      this.$API.role.assignPermissionsToRole({ roleId: this.roleId, permissionIds: ids }).then(\n        result => { this.$message.success('分配成功!'); this.dialogVisible = false; }\n      );\n    }\n  }\n}\n</script>\n\n<style scoped>\n.edit-input {\n  padding-right: 100px;\n}\n\n.cancel-btn {\n  position: absolute;\n  right: 15px;\n  top: 10px;\n}\n\n.tableCss {\n  width: 100%;\n  margin-top: 10px;\n  border: 1px solid #ebeef5;\n}\n\ntable>tr>th {\n  padding: 10px;\n}\n\ntable>tr>td {\n  padding: 10px;\n}\n\nbutton {\n  margin: 10px;\n}\n</style>\n"]}]}