{"remainingRequest":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/chenchi03/IdeaProjects/yuntai-frontend/src/views/acl/role/list.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/src/views/acl/role/list.vue","mtime":1672390200000},{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1749371729293},{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/babel-loader/lib/index.js","mtime":1749371729596},{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1749371729293},{"path":"/Users/chenchi03/IdeaProjects/yuntai-frontend/node_modules/vue-loader/lib/index.js","mtime":1749371729670}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnUm9sZUxpc3QnLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgYWxsUGVybWlzc2lvbnM6IFtdLAogICAgICByb2xlSWQ6IC0xLAogICAgICByb2xlTmFtZTogJycsCiAgICAgIGRlZmF1bHRQcm9wczogewogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLAogICAgICAgIGxhYmVsOiAncGVybWlzc2lvbk5hbWUnCiAgICAgIH0sCiAgICAgIGxpc3RMb2FkaW5nOiB0cnVlLCAvLyDmlbDmja7mmK/lkKbmraPlnKjliqDovb0KICAgICAgcm9sZXM6IFtdLCAvLyDop5LoibLliJfooagKICAgICAgc2VsZWN0ZWRSb2xlczogW10gLy8g5omA5pyJ6YCJ5Lit55qE6KeS6Imy5YiX6KGoCiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5nZXRSb2xlcygpCiAgfSwKICBtZXRob2RzOiB7CiAgICAvKgogICAg5re75Yqg6KeS6ImyCiAgICAqLwogICAgYWRkUm9sZSgpIHsKICAgICAgLy8g5pi+56S65re75Yqg55WM6Z2iCiAgICAgIHRoaXMuJHByb21wdCgn6K+36L6T5YWl5paw5ZCN56ewJywgJ+a3u+WKoOinkuiJsicsIHsKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgIH0pLnRoZW4oKHsgdmFsdWUgfSkgPT4gewogICAgICAgIHRoaXMuJEFQSS5yb2xlLnNhdmUoeyByb2xlTmFtZTogdmFsdWUgfSkudGhlbihyZXN1bHQgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKHJlc3VsdC5tZXNzYWdlIHx8ICfmt7vliqDop5LoibLmiJDlip8nKQogICAgICAgICAgdGhpcy5nZXRSb2xlcygpCiAgICAgICAgfSkKICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn5Y+W5raI5re75YqgJykKICAgICAgfSkKICAgIH0sCiAgICBzaG93QXNzaWduUm9sZURpYWxvZyhyb2xlSWQsIHJvbGVOYW1lKSB7CiAgICAgIHRoaXMucm9sZUlkID0gcm9sZUlkOwogICAgICB0aGlzLnJvbGVOYW1lID0gcm9sZU5hbWU7CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7CiAgICAgIHRoaXMuJEFQSS5wZXJtaXNzaW9uLnRvQXNzaWduKHJvbGVJZCkudGhlbihyZXN1bHQgPT4gewogICAgICAgIGNvbnN0IGFsbFBlcm1pc3Npb25zID0gcmVzdWx0LmRhdGEKICAgICAgICB0aGlzLmFsbFBlcm1pc3Npb25zID0gYWxsUGVybWlzc2lvbnMKICAgICAgICBjb25zdCBjaGVja2VkSWRzID0gdGhpcy5nZXRDaGVja2VkSWRzKGFsbFBlcm1pc3Npb25zKQogICAgICAgIGNvbnNvbGUubG9nKCdnZXRQZXJtaXNzaW9ucygpIGNoZWNrZWRJZHMnLCBjaGVja2VkSWRzKQogICAgICAgIHRoaXMuJHJlZnMudHJlZS5zZXRDaGVja2VkS2V5cyhjaGVja2VkSWRzKQogICAgICB9KTsKICAgIH0sCgogICAgLyoKICAgICAg5b6X5Yiw5omA5pyJ6YCJ5Lit55qEaWTliJfooagKICAgICAgKi8KICAgIGdldENoZWNrZWRJZHMoYXV0aHMsIGluaXRBcnIgPSBbXSkgewogICAgICByZXR1cm4gYXV0aHMucmVkdWNlKChwcmUsIGl0ZW0pID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhpdGVtLnNlbGVjdCk7CiAgICAgICAgaWYgKGl0ZW0uc2VsZWN0ICYmIGl0ZW0ubGV2ZWwgPT09IDMpIHsKICAgICAgICAgIHByZS5wdXNoKGl0ZW0uaWQpCiAgICAgICAgfSBlbHNlIGlmIChpdGVtLmNoaWxkcmVuKSB7CiAgICAgICAgICB0aGlzLmdldENoZWNrZWRJZHMoaXRlbS5jaGlsZHJlbiwgaW5pdEFycikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByZQogICAgICB9LCBpbml0QXJyKQogICAgfSwKCiAgICAvKgogICAg5byC5q2l6I635Y+W6KeS6Imy5YiG6aG15YiX6KGoCiAgICAqLwogICAgZ2V0Um9sZXMocGFnZSA9IDEpIHsKICAgICAgdGhpcy5wYWdlID0gcGFnZQogICAgICB0aGlzLmxpc3RMb2FkaW5nID0gdHJ1ZQogICAgICB0aGlzLiRBUEkucm9sZS5nZXRQYWdlTGlzdCgpLnRoZW4oCiAgICAgICAgcmVzdWx0ID0+IHsKICAgICAgICAgIHRoaXMucm9sZXMgPSByZXN1bHQuZGF0YTsKICAgICAgICB9CiAgICAgICkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgdGhpcy5saXN0TG9hZGluZyA9IGZhbHNlOwogICAgICB9KQogICAgfSwKICAgIC8qCiAgICDliKDpmaTmjIflrprnmoTop5LoibIKICAgICovCiAgICByZW1vdmVSb2xlKHJvbGVJZCwgcm9sZU5hbWUpIHsKICAgICAgdGhpcy4kY29uZmlybShg56Gu5a6a5Yig6ZmkICcke3JvbGVOYW1lfScg5ZCXP2AsICfmj5DnpLonLCB7CiAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgIH0pLnRoZW4oYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuJEFQSS5yb2xlLnJlbW92ZUJ5SWQocm9sZUlkKTsKICAgICAgICB0aGlzLmdldFJvbGVzKHRoaXMucm9sZXMubGVuZ3RoID09PSAxID8gdGhpcy5wYWdlIC0gMSA6IHRoaXMucGFnZSk7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKHJlc3VsdC5tZXNzYWdlIHx8ICfliKDpmaTmiJDlip8hJyk7CiAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmluZm8oJ+W3suWPlua2iOWIoOmZpCcpOwogICAgICB9KQogICAgfSwKICAgIGFzc2lnblJvbGVzKCkgewogICAgICB2YXIgaWRzID0gdGhpcy4kcmVmcy50cmVlLmdldENoZWNrZWRLZXlzKCkuam9pbignLCcpOwogICAgICB0aGlzLiRBUEkucm9sZS5hc3NpZ25QZXJtaXNzaW9uc1RvUm9sZSh7IHJvbGVJZDogdGhpcy5yb2xlSWQsIHBlcm1pc3Npb25JZHM6IGlkcyB9KS50aGVuKAogICAgICAgIHJlc3VsdCA9PiB7IHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5YiG6YWN5oiQ5YqfIScpOyB0aGlzLmRpYWxvZ1Zpc2libGUgPSBmYWxzZTsgfQogICAgICApOwogICAgfQogIH0KfQo="},{"version":3,"sources":["list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"list.vue","sourceRoot":"src/views/acl/role","sourcesContent":["<template>\n  <div>\n    <!-- 工具条 -->\n    <el-card class=\"operate-container\" shadow=\"never\">\n      <i class=\"el-icon-tickets\" style=\"margin-top: 5px\"></i>\n      <span style=\"margin-top: 5px\">数据列表</span>\n      <el-button class=\"btn-add\" size=\"mini\" @click=\"addRole\">添加新角色</el-button>\n    </el-card>\n\n    <table class=\"tableCss\">\n      <tr style=\"text-align: center;\">\n        <th>ID</th>\n        <th>角色名称</th>\n        <th>操作</th>\n      </tr>\n      <tr v-for=\"item in roles\" style=\"text-align: center;\">\n        <td>{{ item.id }}</td>\n        <td>{{ item.roleName }}</td>\n        <td>\n          <button @click=\"removeRole(item.id, item.roleName)\">删除角色</button>\n          <button @click=\"showAssignRoleDialog(item.id, item.roleName)\">分配权限</button>\n        </td>\n      </tr>\n    </table>\n\n    <el-dialog title=\"添加/修改\" :visible.sync=\"dialogVisible\" width=\"40%\">\n      <el-input disabled :value=\"roleName\" />\n      <el-tree ref=\"tree\" style=\"margin: 20px 0\" :data=\"allPermissions\" node-key=\"id\" show-checkbox default-expand-all\n        :props=\"defaultProps\" />\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button size=\"small\" @click=\"dialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" size=\"small\" @click=\"assignRoles()\">确定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'RoleList',\n  data() {\n    return {\n      dialogVisible: false,\n      allPermissions: [],\n      roleId: -1,\n      roleName: '',\n      defaultProps: {\n        children: 'children',\n        label: 'permissionName'\n      },\n      listLoading: true, // 数据是否正在加载\n      roles: [], // 角色列表\n      selectedRoles: [] // 所有选中的角色列表\n    }\n  },\n  mounted() {\n    this.getRoles()\n  },\n  methods: {\n    /*\n    添加角色\n    */\n    addRole() {\n      // 显示添加界面\n      this.$prompt('请输入新名称', '添加角色', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n      }).then(({ value }) => {\n        this.$API.role.save({ roleName: value }).then(result => {\n          this.$message.success(result.message || '添加角色成功')\n          this.getRoles()\n        })\n      }).catch(() => {\n        this.$message.warning('取消添加')\n      })\n    },\n    showAssignRoleDialog(roleId, roleName) {\n      this.roleId = roleId;\n      this.roleName = roleName;\n      this.dialogVisible = true;\n      this.$API.permission.toAssign(roleId).then(result => {\n        const allPermissions = result.data\n        this.allPermissions = allPermissions\n        const checkedIds = this.getCheckedIds(allPermissions)\n        console.log('getPermissions() checkedIds', checkedIds)\n        this.$refs.tree.setCheckedKeys(checkedIds)\n      });\n    },\n\n    /*\n      得到所有选中的id列表\n      */\n    getCheckedIds(auths, initArr = []) {\n      return auths.reduce((pre, item) => {\n        console.log(item.select);\n        if (item.select && item.level === 3) {\n          pre.push(item.id)\n        } else if (item.children) {\n          this.getCheckedIds(item.children, initArr)\n        }\n        return pre\n      }, initArr)\n    },\n\n    /*\n    异步获取角色分页列表\n    */\n    getRoles(page = 1) {\n      this.page = page\n      this.listLoading = true\n      this.$API.role.getPageList().then(\n        result => {\n          this.roles = result.data;\n        }\n      ).finally(() => {\n        this.listLoading = false;\n      })\n    },\n    /*\n    删除指定的角色\n    */\n    removeRole(roleId, roleName) {\n      this.$confirm(`确定删除 '${roleName}' 吗?`, '提示', {\n        type: 'warning'\n      }).then(async () => {\n        const result = await this.$API.role.removeById(roleId);\n        this.getRoles(this.roles.length === 1 ? this.page - 1 : this.page);\n        this.$message.success(result.message || '删除成功!');\n      }).catch(() => {\n        this.$message.info('已取消删除');\n      })\n    },\n    assignRoles() {\n      var ids = this.$refs.tree.getCheckedKeys().join(',');\n      this.$API.role.assignPermissionsToRole({ roleId: this.roleId, permissionIds: ids }).then(\n        result => { this.$message.success('分配成功!'); this.dialogVisible = false; }\n      );\n    }\n  }\n}\n</script>\n\n<style scoped>\n.edit-input {\n  padding-right: 100px;\n}\n\n.cancel-btn {\n  position: absolute;\n  right: 15px;\n  top: 10px;\n}\n\n.tableCss {\n  width: 100%;\n  margin-top: 10px;\n  border: 1px solid #ebeef5;\n}\n\ntable>tr>th {\n  padding: 10px;\n}\n\ntable>tr>td {\n  padding: 10px;\n}\n\nbutton {\n  margin: 10px;\n}\n</style>\n"]}]}